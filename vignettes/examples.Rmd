---
title: "Examples"
output: html_document
---

```{r, echo=FALSE, message=FALSE}
devtools::load_all("..")
```

```{r options, echo=FALSE, message=FALSE}
simrOptions(progress=FALSE)
```

First we'll set the default number of simulations to a lower value. This will allow us to run the examples more quickly.

```{r}
simrOptions(nSim=25)
```

## Binomial GLMM with categorical predictor

The first example comes from the online help for `glmer`. The data frame `cbpp` contains data on contagious bovine pleuropneumonia. Note that the response is specified using `cbind` --- `simr` expects a binomial model to be in this form.

```{r}
gm1 <- glmer(cbind(incidence, size - incidence) ~ period + (1 | herd), data = cbpp, family = binomial)
summary(gm1)
```

Note that `period` is a categorical variable with 4 levels. `simr` will default to a likelihood ratio test comparing `gm1` to the reduced model without the `period` term.

```{r}
powerSim(gm1)
```

If you were (for some reason) especially interested in the power for the dummy variable `period2` you could use a Z-test. This tests the value `Pr(>|z|)` reported in the summary above.

```{r}
powerSim(gm1, fixed("period2", "z"))
```

Suppose your model also has a continuous predictor. You can use `fixed` to choose which fixed effect to apply tests to. 

```{r}
gm2 <- glmer(cbind(incidence, size - incidence) ~ period + size + (1 | herd), data = cbpp, family = binomial)
fixef(gm2)['size'] <- 0.05
powerSim(gm2, fixed("size"))
```

## Interaction Terms

This example uses the `cake` dataset.

```{r}
fm1 <- lmer(angle ~ recipe * temp + (1|recipe:replicate), cake, REML= FALSE)
summary(fm1)
```

Main effects should not be tested when they appear in an interaction term. Using the `compare` function, we can specify a comparison with a simpler model.

```{r}
powerSim(fm1, compare(angle ~ recipe + temp + (1|recipe:replicate)))
```

## More Examples?


```{r}
form <- TICKS ~ YEAR + cHEIGHT + (1|BROOD) + (1|INDEX) + (1|LOCATION)
full_mod1  <- glmer(form, family="poisson",data=grouseticks)
```



```{r}
cbpp$obs <- 1:nrow(cbpp)
(gm2 <- glmer(cbind(incidence, size - incidence) ~ period + (1 | herd) + (1|obs), family = binomial, data = cbpp))
```



```{r}
fm1 <- lmer(Reaction ~ Days + (Days|Subject), sleepstudy)
fm1 <- lmer(Yield ~ 1|Batch, Dyestuff)
```

```{r}
data(Orthodont,package="nlme")
lmer(distance ~ age + (age|Subject) + (0+dummy(Sex, "Female")|Subject), data = Orthodont)
fm1 <- lmer(distance ~ age + (age|Subject), data=Orthodont)
```



```{r}
form <- TICKS~YEAR+HEIGHT+(1|BROOD)+(1|INDEX)+(1|LOCATION)
(full_mod1 <- glmer(form, family="poisson",data=grouseticks))
```




```{r}
fm1 <- lmer(Reaction ~ Days + (Days | Subject), sleepstudy)
fm2 <- lmer(Reaction ~ Days + (Days || Subject), sleepstudy)
fm3 <- update(fm1, . ~. - (Days| Subject) + (1| Subject))
```